<html>
<head>
<title>Plugin test page</title>
</head>
<script type="text/javascript" src="jquery-1.9.1.js"></script>
<script type="text/javascript" src="../../DataStream.js/DataStream.js"></script>
<script type="text/javascript" src="../taglib.js"></script>
<script type="text/javascript">
$(function(){
	plugin = $('object#plugin').get(0);
	$(document.body).append($('<p>').html('Plugin is ' + (plugin.valid ? 'valid' : 'invalid')));

	$('#file').change(function(evt) {
		var file = evt.target.files[0];
		if (!file) {
			return;
		}
		var reader = new FileReader();
		reader.onload = function(e) {
			var time0 = new Date();
			
			var arrayBuffer = e.target.result;
			var arrayBufferStream = new TagLib.ArrayBufferStream(arrayBuffer);
			
			/*plugin.parse(arrayBufferStream, function(file) {
				var tag = file.tag();
				console.info('artist', tag.artist);
				console.info('album', tag.album);
				console.info('title', tag.title);
				console.info('comment', tag.comment);
				console.info('genre', tag.genre);
				console.info('year', tag.year);
				console.info('track', tag.track);
				console.info('isEmpty', tag.isEmpty());
			});*/
			
			console.debug(arrayBufferStream.length());
			arrayBufferStream.insert([1, 2, 3], 10, 3);
			arrayBufferStream.seek(arrayBufferStream.tell() - 1, 0);
			console.debug(arrayBufferStream.readBlock(10));
			
			console.debug('Parse time', new Date() - time0);
		};
		reader.readAsArrayBuffer(file);
	});
})
</script>
<body>
	<object id="plugin" type="application/x-taglib" width="0" height="0"></object>
	<input type="file" id="file" />
</body>
</html>
